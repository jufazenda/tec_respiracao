import Question from './Question'
import ProgressBar from '../ProgressBar'
import Review from '../Review'
import { QuestionType } from '@/Types/Props'
import { useState } from 'react'

const questions: QuestionType[] = [
  {
    question: 'O que é a terapia expiratória manual passiva?',
    options: [
      'Uma técnica para promover a inspiração forçada',
      'Um método para induzir a tosse reflexa em pacientes',
      'Uma técnica passiva utilizada para facilitar a expiração sem esforço ativo do paciente',
      'Um procedimento para aumentar a capacidade vital pulmonar',
      'Um exercício para fortalecer os músculos respiratórios',
    ],
    answer:
      'Uma técnica passiva utilizada para facilitar a expiração sem esforço ativo do paciente',
    explanation:
      'A terapia expiratória manual passiva é utilizada para auxiliar a expiração de pacientes que não conseguem realizar este movimento de forma ativa.',
  },
  {
    question:
      'Qual é o principal objetivo da técnica de aceleração do fluxo expiratório?',
    options: [
      'Aumentar a inspiração máxima do paciente',
      'Reduzir o volume de ar residual nos pulmões',
      'Aumentar a pressão arterial durante a expiração',
      'Facilitar a remoção de secreções pulmonares, acelerando o fluxo do ar expirado',
      'Promover o relaxamento muscular durante a expiração',
    ],
    answer:
      'Facilitar a remoção de secreções pulmonares, acelerando o fluxo do ar expirado',
    explanation:
      'A técnica de aceleração do fluxo expiratório ajuda a remover secreções pulmonares ao acelerar o fluxo de ar durante a expiração.',
  },
  {
    question:
      'A manobra de aceleração de fluxo é mais frequentemente utilizada em pacientes com:',
    options: [
      'Doenças neurológicas',
      'Lesões ortopédicas',
      'Doenças respiratórias com acúmulo de secreções, como bronquite e fibrose cística',
      'Transtornos psicológicos',
      'Problemas cardiovasculares',
    ],
    answer:
      'Doenças respiratórias com acúmulo de secreções, como bronquite e fibrose cística',
    explanation:
      'A manobra de aceleração de fluxo é indicada para pacientes com doenças respiratórias que apresentam secreções pulmonares, como bronquite crônica e fibrose cística.',
  },
  {
    question:
      'A manobra de Farley Campos é diferente de outras técnicas de aceleração de fluxo porque:',
    options: [
      'Envolve a aplicação de pressão no abdômen durante a inspiração',
      'Utiliza a força do paciente para auxiliar na expiração',
      'É realizada com a ajuda de dispositivos mecânicos',
      'Envolve a compressão torácica e redirecionamento do fluxo expiratório com o mínimo de força aplicada',
      'É realizada somente em pacientes com traqueostomia',
    ],
    answer:
      'Envolve a compressão torácica e redirecionamento do fluxo expiratório com o mínimo de força aplicada',
    explanation:
      'A manobra de Farley Campos utiliza a compressão torácica leve e redireciona o fluxo expiratório, facilitando a remoção de secreções sem grande aplicação de força.',
  },
  {
    question:
      'Qual é o principal benefício da manobra de redirecionamento de fluxo?',
    options: [
      'Fortalecer os músculos respiratórios',
      'Promover o relaxamento dos brônquios',
      'Melhorar a ventilação seletiva em áreas específicas dos pulmões',
      'Aumentar a pressão arterial durante a respiração',
      'Ajudar a prevenir infecções respiratórias',
    ],
    answer:
      'Melhorar a ventilação seletiva em áreas específicas dos pulmões',
    explanation:
      'A manobra de redirecionamento de fluxo é usada para direcionar o fluxo de ar para áreas pulmonares menos ventiladas, ajudando na melhora da oxigenação.',
  },
  {
    question:
      'A técnica de compressão e descompressão torácica é indicada para:',
    options: [
      'Pacientes com hipertensão arterial',
      'Pacientes com dificuldade em eliminar secreções pulmonares',
      'Indivíduos saudáveis em treinamento esportivo',
      'Crianças com asma leve',
      'Pacientes com deformidades da coluna vertebral',
    ],
    answer: 'Pacientes com dificuldade em eliminar secreções pulmonares',
    explanation:
      'A técnica de compressão e descompressão torácica ajuda na remoção de secreções pulmonares, especialmente em pacientes que têm dificuldade em expectorar.',
  },
  {
    question:
      'Quais são as contraindicações para a realização da manobra de compressão torácica?',
    options: [
      'Insuficiência cardíaca, osteoporose, e pós-operatório de cirurgias abdominais',
      'Pneumonia leve e asma controlada',
      'Pacientes sem histórico de doenças respiratórias',
      'Pacientes com boa capacidade inspiratória e expiratória',
      'Indivíduos em reabilitação neuromotora',
    ],
    answer:
      'Insuficiência cardíaca, osteoporose, e pós-operatório de cirurgias abdominais',
    explanation:
      'A manobra de compressão torácica é contraindicada em pacientes com insuficiência cardíaca, osteoporose ou que estão em pós-operatório de cirurgias abdominais, devido ao risco de lesões.',
  },
  {
    question: 'A técnica de aceleração do fluxo é preferível quando:',
    options: [
      'O paciente apresenta pouca mobilidade torácica',
      'O paciente apresenta secreções pulmonares abundantes',
      'O paciente está em recuperação pós-cirúrgica',
      'O paciente tem hipertensão arterial',
      'O paciente possui alta capacidade pulmonar',
    ],
    answer: 'O paciente apresenta secreções pulmonares abundantes',
    explanation:
      'A técnica de aceleração do fluxo é recomendada para pacientes que têm secreções pulmonares abundantes e precisam de ajuda para eliminá-las.',
  },
  {
    question:
      'O que pode indicar a necessidade de utilizar a manobra de redirecionamento de fluxo?',
    options: [
      'Tosse seca e ineficaz',
      'Presença de secreção localizada em áreas específicas dos pulmões',
      'Dificuldade para inspirar profundamente',
      'Hiperventilação constante',
      'Saturação de oxigênio superior a 98%',
    ],
    answer:
      'Presença de secreção localizada em áreas específicas dos pulmões',
    explanation:
      'A manobra de redirecionamento de fluxo é indicada quando há secreção localizada em áreas específicas dos pulmões, melhorando a ventilação e a remoção de secreções.',
  },
  {
    question:
      'Quais são os principais desafios ao aplicar técnicas manuais expiratórias em pacientes com doenças respiratórias crônicas?',
    options: [
      'Controle da pressão arterial e frequência cardíaca',
      'Evitar a hiperinflação pulmonar',
      'Monitoramento constante da frequência respiratória e da tolerância do paciente',
      'Realizar a técnica sem causar desconforto na região abdominal',
      'Gerenciar a dor torácica durante a expiração',
    ],
    answer:
      'Monitoramento constante da frequência respiratória e da tolerância do paciente',
    explanation:
      'Um dos principais desafios ao aplicar técnicas manuais expiratórias é monitorar a frequência respiratória e a tolerância do paciente para garantir que a técnica seja segura e eficaz.',
  },
]

const Quiz = () => {
  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0)
  const [score, setScore] = useState(0)
  const [showScore, setShowScore] = useState(false)
  const [status, setStatus] = useState<
    ('correct' | 'incorrect' | 'pending')[]
  >(new Array(questions.length).fill('pending'))

  const [userAnswers, setUserAnswers] = useState<string[]>(
    new Array(questions.length).fill('')
  )

  const handleAnswerOptionClick = (isCorrect: boolean) => {
    const newStatus = [...status]
    const newUserAnswers = [...userAnswers]

    newStatus[currentQuestionIndex] = isCorrect ? 'correct' : 'incorrect'
    newUserAnswers[currentQuestionIndex] =
      questions[currentQuestionIndex].options.find(
        option => option === questions[currentQuestionIndex].answer
      ) || ''

    setStatus(newStatus)
    setUserAnswers(newUserAnswers)

    if (isCorrect) {
      setScore(score + 1)
    }

    const nextQuestion = currentQuestionIndex + 1
    if (nextQuestion < questions.length) {
      setCurrentQuestionIndex(nextQuestion)
    } else {
      setShowScore(true)
    }
  }

  return (
    <div className='flex flex-col items-center gap-5'>
      {showScore ? (
        <>
          <div className='text-2xl'>
            Você acertou {score} de {questions.length} questões.
          </div>
          <Review
            questions={questions}
            userAnswers={userAnswers}
            status={status}
          />
        </>
      ) : (
        <>
          <div className='w-full overflow-x-hidden'>
            <span className='text-xl font-bold text-primary_darker'>
              Questão {currentQuestionIndex + 1} de {questions.length}
            </span>
            <hr className='w-full my-4 border-t-2 border-gray-300' />
          </div>
          <Question
            question={questions[currentQuestionIndex].question}
            options={questions[currentQuestionIndex].options}
            handleAnswerOptionClick={handleAnswerOptionClick}
            answer={questions[currentQuestionIndex].answer}
          />
          <ProgressBar
            currentQuestionIndex={currentQuestionIndex}
            totalQuestions={questions.length}
            status={status}
          />
        </>
      )}
    </div>
  )
}

export default Quiz
